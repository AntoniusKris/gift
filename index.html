<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wedding Gift</title>

<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
/* ---------- MOBILE SAFETY ---------- */
html, body {
  touch-action: manipulation;
  overscroll-behavior: none;
}

/* ---------- BASE ---------- */
body {
  margin: 0;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: linear-gradient(135deg, #f7efe5, #efe1d1);
  font-family: Georgia, serif;
  color: #4a3f35;
  overflow: hidden;
}

.container {
  text-align: center;
  position: relative;
  z-index: 2;
  padding: 0 12px;
}

.instruction {
  font-size: 18px;
  margin-bottom: 20px;
  transition: opacity 0.6s ease;
}

/* ---------- UI HIDE ---------- */
.ui-hidden {
  opacity: 0;
  pointer-events: none;
}

/* ---------- GIFT ---------- */
.gift {
  width: 180px;
  cursor: pointer;
  touch-action: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  transform-origin: center;
  will-change: transform;
}

.gift.idle:hover {
  animation: shake-slow 0.35s infinite;
}

/* ---------- ANIMATIONS ---------- */
@keyframes shake-slow {
  0% { transform: rotate(0deg); }
  25% { transform: rotate(3deg); }
  75% { transform: rotate(-3deg); }
}

@keyframes shake-fast {
  0% { transform: rotate(0deg); }
  25% { transform: rotate(6deg); }
  75% { transform: rotate(-6deg); }
}

.zooming {
  animation: zoomIn 5s forwards;
}

@keyframes zoomIn {
  to { transform: scale(2.2); }
}

.shaking-fast {
  animation: shake-fast 0.1s infinite;
}

.explode {
  animation: explode 0.5s forwards;
}

@keyframes explode {
  to { transform: scale(3); opacity: 0; }
}

/* ---------- COUNTER ---------- */
.counter {
  margin-top: 12px;
  font-size: 14px;
  opacity: 0.7;
  transition: opacity 0.6s ease;
}

.failed {
  color: #b00020;
  margin-top: 12px;
  transition: opacity 0.6s ease;
}

/* ---------- MESSAGE CARD ---------- */
.message {
  display: none;
  background: rgba(255,255,255,0.75);
  backdrop-filter: blur(14px);
  margin-top: 30px;
  padding: 30px;
  border-radius: 18px;
  max-width: 600px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.15);
  animation: fadeText 3s ease forwards;
}

@keyframes fadeText {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ---------- BACKGROUND ---------- */
.bg-slideshow {
  position: fixed;
  inset: 0;
  z-index: 0;
}

.bg-slide {
  position: absolute;
  inset: 0;
  background-size: cover;
  background-position: center;
  opacity: 0;
  transform: scale(1);
  transition: opacity 2s ease;
}

.bg-slide.active {
  opacity: 1;
  animation: zoomBg 10s linear forwards;
}

@keyframes zoomBg {
  to { transform: scale(1.1); }
}

/* ---------- CONFETTI ---------- */
.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  top: -10px;
  animation: fall linear forwards;
  z-index: 3;
}

@keyframes fall {
  to { transform: translateY(110vh) rotate(720deg); }
}

/* ---------- MUSIC BUTTON ---------- */
.music-btn {
  margin-top: 20px;
  padding: 10px 22px;
  border: none;
  border-radius: 22px;
  background: #4a3f35;
  color: #fff;
  cursor: pointer;
  font-size: 15px;
}

/* ---------- MOBILE ---------- */
@media (max-width: 768px) {
  .gift { width: 260px; }
  .instruction { font-size: 20px; }
  .counter { font-size: 16px; }

  .message {
    max-width: 92vw;
    padding: 26px 22px;
  }

  .message h1 { font-size: 26px; }
  .message h2 { font-size: 20px; }
  .message p {
    font-size: 16px;
    line-height: 1.6;
  }
}
</style>
</head>

<body>

<!-- BACKGROUND -->
<div class="bg-slideshow">
  <div class="bg-slide" style="background-image:url('bg1.jpeg')"></div>
  <div class="bg-slide" style="background-image:url('bg2.jpeg')"></div>
  <div class="bg-slide" style="background-image:url('bg3.jpeg')"></div>
</div>

<!-- AUDIO -->
<audio id="bgMusic" loop>
  <source src="wedding-music.mp3" type="audio/mpeg">
</audio>

<div class="container">
  <div class="instruction" id="instruction">
    üéÅ Tap <strong>27 times continuously</strong>
  </div>

  <img id="gift" class="gift idle"
  src="data:image/svg+xml;utf8,
  <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'>
    <rect x='30' y='70' width='140' height='100' rx='12' fill='%23c94c4c'/>
    <rect x='90' y='70' width='20' height='100' fill='%23f5d76e'/>
    <rect x='30' y='105' width='140' height='20' fill='%23f5d76e'/>
    <rect x='30' y='50' width='140' height='30' rx='10' fill='%23a83c3c'/>
    <circle cx='100' cy='45' r='15' fill='%23f5d76e'/>
  </svg>">

  <div class="counter" id="counter">0 / 27</div>
  <div class="failed" id="failed"></div>

  <div class="message" id="message">
    <h1>Happy Wedding Day</h1>
    <h2>Jyesta & Nunil</h2>
    <p>
      May your love grow stronger every day,<br>
      your friendship be your foundation,<br>
      and your home be filled with peace and joy.
    </p>
    <p><em>With love,<br>Your best friend</em></p>

    <button class="music-btn" id="musicBtn">‚è∏ Pause Music</button>
  </div>
</div>

<script>
/* ---------- TAP LOGIC ---------- */
const gift = document.getElementById("gift");
const counter = document.getElementById("counter");
const failed = document.getElementById("failed");
const instruction = document.getElementById("instruction");
const message = document.getElementById("message");

const MAX_DELAY = 200;
const REQUIRED_TAPS = 27;

let taps = 0;
let lastTap = null;
let timer = null;
let opened = false;

gift.addEventListener("pointerdown", e => {
  e.preventDefault();
  if (opened) return;

  const now = Date.now();
  if (lastTap && now - lastTap > MAX_DELAY) return check();

  lastTap = now;
  taps++;
  counter.textContent = taps + " / 27";

  if (taps > REQUIRED_TAPS) return reset("‚ùå Too many taps");

  clearTimeout(timer);
  timer = setTimeout(check, MAX_DELAY + 10);
});

function reset(msg) {
  taps = 0;
  lastTap = null;
  counter.textContent = "0 / 27";
  failed.textContent = msg;
}

function check() {
  if (taps === REQUIRED_TAPS) openGift();
  else reset("‚ùå Must be exactly 27 taps");
}

/* ---------- OPEN ---------- */
const slides = document.querySelectorAll(".bg-slide");
const music = document.getElementById("bgMusic");
const btn = document.getElementById("musicBtn");
let slideIndex = 0;

function openGift() {
  opened = true;

  instruction.classList.add("ui-hidden");
  counter.classList.add("ui-hidden");
  failed.classList.add("ui-hidden");

  gift.classList.add("zooming");

  setTimeout(() => gift.classList.add("shaking-fast"), 2000);
  setTimeout(() => {
    gift.classList.add("explode");
    startConfetti();
  }, 5000);
  setTimeout(showMessage, 5500);
}

function showMessage() {
  gift.style.display = "none";
  message.style.display = "block";
  startSlideshow();
  fadeInMusic();
}

/* ---------- SLIDES ---------- */
function startSlideshow() {
  slides[0].classList.add("active");
  setInterval(() => {
    slides[slideIndex].classList.remove("active");
    slideIndex = (slideIndex + 1) % slides.length;
    slides[slideIndex].classList.add("active");
  }, 10000);
}

/* ---------- MUSIC ---------- */
function fadeInMusic() {
  music.volume = 0;
  music.play();
  let v = 0;
  const fade = setInterval(() => {
    v += 0.02;
    music.volume = Math.min(v, 0.6);
    if (v >= 0.6) clearInterval(fade);
  }, 100);
}

btn.onclick = () => {
  if (music.paused) {
    music.play();
    btn.textContent = "‚è∏ Pause Music";
  } else {
    music.pause();
    btn.textContent = "‚ñ∂ Play Music";
  }
};

/* ---------- CONFETTI ---------- */
function startConfetti() {
  setInterval(() => {
    for (let i = 0; i < 6; i++) {
      const c = document.createElement("div");
      c.className = "confetti";
      c.style.left = Math.random() * 100 + "vw";
      c.style.background = `hsl(${Math.random()*360},80%,60%)`;
      c.style.animationDuration = (Math.random()*2 + 3) + "s";
      document.body.appendChild(c);
      setTimeout(() => c.remove(), 6000);
    }
  }, 300);
}
</script>

</body>
</html>
